<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Personagem - Tormenta 20</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <title>Ficha Tormenta 20</title>
</head>
<body>
    <!-- Auto-retractable sidebar -->
    <aside id="sheets-drawer" class="sheets-drawer" aria-hidden="false">
        <div class="sheets-drawer__mini-content">
            <div class="sheets-drawer__mini-icon">üìë</div>
        </div>
        <div class="sheets-drawer__full-content">
            <button id="lockSidebarBtn" class="sheets-drawer__lock-btn" type="button" title="Manter aberto">üìå</button>
            <div class="sheets-drawer__header">
                <h2>Fichas</h2>
            </div>
            <div class="sheets-drawer__actions">
                <button id="newSheetBtn" class="btn btn--primary btn--sm" type="button">+ Nova Ficha</button>
            </div>
            <ul id="sheets-list" class="sheets-list" aria-label="Lista de fichas"></ul>
        </div>
    </aside>

    <div id="main-container" class="container">
        <header class="header">
            <div class="header-content">
                <h1>Ficha de Personagem</h1>
                <!-- √Årea da foto do personagem -->
                <div class="character-photo-container">
                    <div class="character-photo-wrapper">
                        <div id="character-photo-circle" style="position:relative;">
                            <img id="character-photo" src="" alt="Foto do personagem" style="display:none;" draggable="false">
                            <button id="editPhotoBtn" type="button" style="position:absolute;bottom:8px;right:8px;background:var(--color-primary);color:#fff;border:none;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.12);cursor:pointer;z-index:2;">
                                <span style="font-size:1.3em;">‚úèÔ∏è</span>
                            </button>
                        </div>
                        <div class="photo-controls">
                            <input type="file" id="photoInput" accept="image/*" style="display:none;">
                            <!-- Remover o antigo bot√£o addPhotoBtn -->
                            <div class="photo-instructions" style="font-size:12px; color:#888; margin-top:4px;">Arraste para ajustar a posi√ß√£o. Use o zoom.</div>
                        </div>
                    </div>
                </div>
                <!-- Fim √°rea foto -->
                <div class="header-actions">
                    <button class="btn btn--secondary" id="importBtn">
                        <span>üìÑ</span> Importar JSON
                    </button>
                    <button class="btn btn--primary" id="exportBtn">
                        <span>üíæ</span> Exportar JSON
                    </button>
                    <button class="btn btn--secondary" id="resetBtn">Zerar Ficha</button>
                    <button class="btn btn--secondary" id="themeToggleBtn" title="Alternar tema">
                        <span id="themeToggleIcon">üåô</span>
                    </button>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".json" style="display: none;">
        </header>

        <div class="alert alert--error" id="errorAlert" style="display: none;">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="errorMessage"></span>
        </div>

        <div class="alert alert--success" id="successAlert" style="display: none;">
            <span class="alert-icon">‚úÖ</span>
            <span id="successMessage"></span>
        </div>

        <main class="main-content">

            <!-- Quick Navigation -->
            <div class="quick-nav">
                <button class="nav-btn" data-section="basic-info">Informa√ß√µes B√°sicas</button>
                <button class="nav-btn" data-section="attributes">Atributos</button>
                <button class="nav-btn" data-section="defense">Defesa</button>
                <button class="nav-btn" data-section="skills">Per√≠cias</button>
                <button class="nav-btn" data-section="abilities">Habilidades</button>
                <button class="nav-btn" data-section="magic">Magias</button>
                <button class="nav-btn" data-section="inventory">Invent√°rio</button>
            </div>

            <!-- Informa√ß√µes B√°sicas e Classes -->
            <section id="basic-info" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('basic-info')">
                    <h2>Informa√ß√µes B√°sicas <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="basic-grid">
                        <div class="basic-main">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="nome">Nome</label>
                                    <input type="text" class="form-control" id="nome" placeholder="Nome do personagem">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="nivel">N√≠vel</label>
                                    <input type="number" class="form-control" id="nivel" min="1" max="20" value="1" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="raca">Ra√ßa</label>
                                    <input type="text" class="form-control" id="raca" placeholder="Ra√ßa do personagem">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="divindade">Divindade</label>
                                    <input type="text" class="form-control" id="divindade" placeholder="Divindade">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="tendencia">Tend√™ncia</label>
                                    <input type="text" class="form-control" id="tendencia" placeholder="Tend√™ncia">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="origem">Origem</label>
                                    <input type="text" class="form-control" id="origem" placeholder="Origem">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="deslocamento">Deslocamento</label>
                                    <input type="number" class="form-control" id="deslocamento" value="9">
                                </div>
                            </div>
                        </div>
                        <div class="basic-classes">
                            <div class="classes-header">
                                <h3>Classes</h3>
                                <button class="btn btn--sm btn--secondary" type="button" onclick="app.addClass()">+ Adicionar Classe</button>
                            </div>
                            <div id="classes-container"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Atributos -->
            <section id="atributos" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('atributos')">
                    <h2>Atributos <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="attributes-grid">
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>FOR</h3>
                                <span class="attribute-name">For√ßa</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="forca" value="10">
                            </div>
                            <div class="attribute-modifier" id="forca-mod">+0</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>DES</h3>
                                <span class="attribute-name">Destreza</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="destreza" value="10">
                            </div>
                            <div class="attribute-modifier" id="destreza-mod">+0</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>CON</h3>
                                <span class="attribute-name">Constitui√ß√£o</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="constituicao" value="10">
                            </div>
                            <div class="attribute-modifier" id="constituicao-mod">+0</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>INT</h3>
                                <span class="attribute-name">Intelig√™ncia</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="inteligencia" value="10">
                            </div>
                            <div class="attribute-modifier" id="inteligencia-mod">+0</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>SAB</h3>
                                <span class="attribute-name">Sabedoria</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="sabedoria" value="10">
                            </div>
                            <div class="attribute-modifier" id="sabedoria-mod">+0</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-header">
                                <h3>CAR</h3>
                                <span class="attribute-name">Carisma</span>
                            </div>
                            <div class="attribute-value">
                                <input type="number" class="form-control attribute-input" id="carisma" value="10">
                            </div>
                            <div class="attribute-modifier" id="carisma-mod">+0</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Defesa e Iniciativa -->
            <section id="defense" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('defense')">
                    <h2>Defesa <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="defense-grid">
                        <div class="defense-item">
                            <label class="form-label">Defesa</label>
                            <div class="defense-value" id="defesa-total">10</div>
                            <div class="defense-breakdown">
                                <span>10 + DES (<span id="defesa-des">+0</span>) + Armadura (<span id="defesa-armadura">+0</span>)</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="bonus-armadura">B√¥nus Armadura</label>
                            <input type="number" class="form-control" id="bonus-armadura" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="bonus-escudo">B√¥nus Escudo</label>
                            <input type="number" class="form-control" id="bonus-escudo" value="0">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recursos -->
            <section id="recursos" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('recursos')">
                    <h2>Recursos <span class="section-toggle">‚ñº</span></h2>
                    <button class="btn btn--sm btn--secondary" id="addResourceBtn">+ Adicionar Recurso</button>
                </div>
                <div class="card__body">
                    <div class="resources-container">
                        <div class="resource-item">
                            <div class="resource-header">
                                <h3>Vida</h3>
                                <div class="resource-values">
                                    <input type="number" class="form-control resource-current" id="vida-atual" min="0" value="0">
                                    <span>/</span>
                                    <input type="number" class="form-control resource-max" id="vida-max" min="0" value="0">
                                </div>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-progress" id="vida-progress" style="background-color: #e53e3e;"></div>
                            </div>
                            <input type="color" class="resource-color" id="vida-color" value="#e53e3e">
                        </div>
                        
                        <div class="resource-item">
                            <div class="resource-header">
                                <h3>Mana</h3>
                                <div class="resource-values">
                                    <input type="number" class="form-control resource-current" id="mana-atual" min="0" value="0">
                                    <span>/</span>
                                    <input type="number" class="form-control resource-max" id="mana-max" min="0" value="0">
                                </div>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-progress" id="mana-progress" style="background-color: #3182ce;"></div>
                            </div>
                            <input type="color" class="resource-color" id="mana-color" value="#3182ce">
                        </div>
                        
                        <div class="resource-item">
                            <div class="resource-header">
                                <h3>Prana</h3>
                                <div class="resource-values">
                                    <input type="number" class="form-control resource-current" id="prana-atual" min="0" value="0">
                                    <span>/</span>
                                    <input type="number" class="form-control resource-max" id="prana-max" min="0" value="0">
                                </div>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-progress" id="prana-progress" style="background-color: #9f7aea;"></div>
                            </div>
                            <input type="color" class="resource-color" id="prana-color" value="#9f7aea">
                        </div>
                    </div>
                    
                    <div id="custom-resources-container"></div>
                </div>
            </section>

            <!-- Per√≠cias -->
            <section id="skills" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('skills')">
                    <h2>Per√≠cias <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="search-container" style="margin-bottom: 1rem;">
                        <input type="text" id="skillSearch" class="search-input" placeholder="üîç Buscar per√≠cia...">
                        <div id="skillSearchResults" class="search-results"></div>
                    </div>
                    <div class="skills-container" id="skills-container">
                        <!-- Skills will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Habilidades -->
            <section id="abilities" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('abilities')">
                    <h2>Habilidades <span class="section-toggle">‚ñº</span></h2>
                    <button class="btn btn--sm btn--secondary" id="addAbilityBtn">+ Adicionar Habilidade</button>
                </div>
                <div class="card__body">
                    <div id="abilities-container"></div>
                </div>
            </section>

            <!-- Poderes -->
            <section id="poderes" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('poderes')">
                    <h2>Poderes <span class="section-toggle">‚ñº</span></h2>
                    <button class="btn btn--sm btn--secondary" id="addPowerBtn">+ Adicionar Poder</button>
                </div>
                <div class="card__body">
                    <div id="powers-container"></div>
                </div>
            </section>

            <!-- Invent√°rio -->
            <section id="inventario" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('inventario')">
                    <h2>Invent√°rio <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="inventory-section">
                        <h3>Dinheiro</h3>
                        <div class="money-grid">
                            <div class="form-group">
                                <label class="form-label">T$ (Tibares)</label>
                                <input type="number" class="form-control" id="money-ts" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PP (Platina)</label>
                                <input type="number" class="form-control" id="money-pp" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PO (Ouro)</label>
                                <input type="number" class="form-control" id="money-po" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PE (Prata)</label>
                                <input type="number" class="form-control" id="money-pe" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PC (Cobre)</label>
                                <input type="number" class="form-control" id="money-pc" min="0" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="inventory-section">
                        <h3>Armas</h3>
                        <div id="weapons-container"></div>
                        <button class="btn btn--sm btn--secondary" id="addWeaponBtn">+ Adicionar Arma</button>
                    </div>
                    
                    <div class="inventory-section">
                        <h3>Armaduras</h3>
                        <div id="armor-container"></div>
                        <button class="btn btn--sm btn--secondary" id="addArmorBtn">+ Adicionar Armadura</button>
                    </div>
                    
                    <div class="inventory-section">
                        <h3>Itens Gerais</h3>
                        <div id="items-container"></div>
                        <button class="btn btn--sm btn--secondary" id="addItemBtn">+ Adicionar Item</button>
                    </div>
                </div>
            </section>

            <!-- Magias -->
            <section id="magic" class="card section collapsible">
                <div class="card__header" onclick="app.toggleSection('magic')">
                    <h2>Magias <span class="section-toggle">‚ñº</span></h2>
                </div>
                <div class="card__body">
                    <div class="spells-tabs">
                        <button class="tab-button active" data-tab="divina">Divina</button>
                        <button class="tab-button" data-tab="arcana">Arcana</button>
                    </div>
                    <div class="spells-content">
                        <div class="tab-content active" id="divina-tab">
                            <button class="btn btn--sm btn--secondary add-spell-btn" data-type="divina">+ Adicionar Magia</button>
                            <div id="divina-spells-accordion"></div>
                        </div>
                        <div class="tab-content" id="arcana-tab">
                            <button class="btn btn--sm btn--secondary add-spell-btn" data-type="arcana">+ Adicionar Magia</button>
                            <div id="arcana-spells-accordion"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de edi√ß√£o de foto -->
    <div id="photoEditModal" class="photo-edit-modal" style="display:none;">
      <div class="photo-edit-modal-backdrop"></div>
      <div class="photo-edit-modal-content">
        <h2>Editar Foto do Personagem</h2>
        <div class="photo-edit-area" style="position:relative;display:flex;flex-direction:column;align-items:center;">
          <div id="photo-edit-circle">
            <img id="photo-edit-img" src="" alt="Foto original" draggable="false">
          </div>
          <input type="file" id="photoEditInput" accept="image/*" style="display:none;">
          <div class="photo-edit-controls">
            <div class="photo-edit-controls-row">
              <button class="btn btn--sm btn--secondary" id="photoEditResetBtn" type="button">Resetar Posi√ß√£o</button>
              <button class="btn btn--sm btn--secondary" id="photoEditRemoveBtn" type="button">Remover Foto</button>
              <button class="btn btn--sm btn--secondary" id="photoEditUploadBtn" type="button">Adicionar ou alterar foto</button>
            </div>
          </div>
          <div class="photo-edit-instructions">Arraste para ajustar a posi√ß√£o. Use o zoom. Clique em "Adicionar ou alterar foto" para trocar a imagem.</div>
        </div>
        <div class="photo-edit-modal-actions">
          <button class="btn btn--primary" id="photoEditSaveBtn" type="button">Salvar</button>
          <button class="btn btn--secondary" id="photoEditCancelBtn" type="button">Cancelar</button>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
